{% extends 'admin/base.html' %}
{% set active_page = 'outgoing_docs' %}
{% block title %}Outgoing Documents{% endblock %}
{% block header_title %}Outgoing Documents{% endblock %}
{% block content %}

<style>
:root {
    --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    --accent-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    --success-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
    --warning-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
    --info-gradient: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
    --card-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    --hover-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
    --border-radius: 20px;
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.documents-container {
    display: flex;
    flex-direction: column;
    gap: 2rem;
    padding: 0 1rem;
}

/* Header Section */
.header-section {
    background: #fff;
    border-radius: var(--border-radius);
    padding: 2rem;
    box-shadow: var(--card-shadow);
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 1rem;
}

.header-left {
    display: flex;
    align-items: center;
    gap: 1.5rem;
}

.header-icon {
    width: 60px;
    height: 60px;
    border-radius: 18px;
    background: var(--primary-gradient);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.8rem;
    color: white;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

.header-title {
    font-size: 1.8rem;
    font-weight: 800;
    color: #333;
    margin: 0;
}

.add-document-btn {
    background: var(--primary-gradient);
    color: white;
    border: none;
    border-radius: 12px;
    padding: 0.8rem 1.5rem;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    gap: 0.5rem;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    text-decoration: none;
}

.add-document-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    color: white;
    text-decoration: none;
}

/* Documents Table Section */
.table-section {
    background: #fff;
    border-radius: var(--border-radius);
    padding: 2rem;
    box-shadow: var(--card-shadow);
    overflow: hidden;
}

.table-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
    gap: 1rem;
}

.table-title {
    font-size: 1.3rem;
    font-weight: 700;
    color: #333;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 1rem;
}

.table-icon {
    width: 40px;
    height: 40px;
    border-radius: 12px;
    background: var(--primary-gradient);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    color: white;
}

.table-container {
    background: #f8fafc;
    border-radius: 15px;
    overflow: hidden;
    border: 1px solid #e2e8f0;
    max-height: 600px;
    overflow-y: auto;
}

.documents-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9rem;
}

.documents-table thead {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    position: sticky;
    top: 0;
    z-index: 10;
}

.documents-table th {
    padding: 1rem;
    text-align: center;
    font-weight: 600;
    font-size: 0.85rem;
    letter-spacing: 0.5px;
    text-transform: uppercase;
    white-space: nowrap;
}

.documents-table tbody tr {
    border-bottom: 1px solid #e2e8f0;
    transition: var(--transition);
}

.documents-table tbody tr:hover {
    background: rgba(102, 126, 234, 0.05);
}

.documents-table td {
    padding: 1rem;
    color: #4a5568;
    text-align: center;
    vertical-align: middle;
}

.document-link {
    color: #667eea;
    font-weight: 600;
    text-decoration: none;
    transition: var(--transition);
}

.document-link:hover {
    color: #764ba2;
    text-decoration: underline;
}

.preview-btn {
    background: var(--success-gradient);
    color: white;
    border: none;
    border-radius: 8px;
    padding: 0.4rem 0.8rem;
    font-size: 0.8rem;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    display: inline-flex;
    align-items: center;
    gap: 0.3rem;
    text-decoration: none;
    box-shadow: 0 2px 8px rgba(67, 233, 123, 0.3);
    margin-right: 0.5rem;
}

.preview-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(67, 233, 123, 0.4);
    color: white;
    text-decoration: none;
}

.edit-btn {
    background: var(--primary-gradient);
    color: white;
    border: none;
    border-radius: 8px;
    padding: 0.4rem 0.8rem;
    font-size: 0.8rem;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    display: inline-flex;
    align-items: center;
    gap: 0.3rem;
    text-decoration: none;
    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
}

    .edit-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        color: white;
        text-decoration: none;
    }

    /* Pagination */
    .pagination-container {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 1rem;
        margin-top: 2rem;
        flex-wrap: wrap;
    }

    .pagination-info {
        color: #666;
        font-size: 0.9rem;
        font-weight: 500;
    }

    .pagination-controls {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .pagination-button {
        background: #fff;
        border: 2px solid #e2e8f0;
        border-radius: 10px;
        padding: 0.6rem 1rem;
        font-size: 0.9rem;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        color: #4a5568;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 0.3rem;
    }

    .pagination-button:hover {
        border-color: #667eea;
        color: #667eea;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.1);
    }

    .pagination-button.active {
        background: var(--primary-gradient);
        border-color: transparent;
        color: white;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .pagination-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
    }

/* Modal Styles */
.modal-overlay {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100vw;
    height: 100vh;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.8) 0%, rgba(118, 75, 162, 0.8) 100%);
    backdrop-filter: blur(10px);
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.modal-overlay.show {
    opacity: 1;
}

.modal-content {
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
    border-radius: 24px;
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(255, 255, 255, 0.1);
    max-width: 600px;
    width: 90vw;
    max-height: 88vh;
    overflow-y: auto;
    transform: scale(0.7) translateY(-30px) rotateX(5deg);
    opacity: 0;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.modal-overlay.show .modal-content {
    transform: scale(1) translateY(0) rotateX(0deg);
    opacity: 1;
}

.modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 2.5rem 3rem 2rem 3rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 24px 24px 0 0;
    position: relative;
    overflow: hidden;
}

.modal-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.1"/><circle cx="50" cy="10" r="0.5" fill="white" opacity="0.1"/><circle cx="10" cy="60" r="0.5" fill="white" opacity="0.1"/><circle cx="90" cy="40" r="0.5" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
    opacity: 0.3;
}

.modal-title {
    font-size: 1.6rem;
    font-weight: 800;
    color: white;
    margin: 0;
    position: relative;
    z-index: 1;
    display: flex;
    align-items: center;
    gap: 1rem;
}

.modal-title::before {
    content: '📄';
    font-size: 1.8rem;
}

.modal-close {
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    font-size: 1.5rem;
    color: white;
    cursor: pointer;
    padding: 0;
    width: 45px;
    height: 45px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    z-index: 1;
    backdrop-filter: blur(10px);
}

.modal-close:hover {
    background: rgba(255, 255, 255, 0.3);
    border-color: rgba(255, 255, 255, 0.5);
    transform: scale(1.1) rotate(90deg);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
}

.modal-body {
    padding: 1rem;
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
}

.form-group {
    margin-bottom: 0.6rem;
    position: relative;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.6rem;
}

.form-label {
    font-weight: 700;
    color: #2d3748;
    font-size: 0.8rem;
    margin-bottom: 0.2rem;
    display: block;
    position: relative;
    padding-left: 0.8rem;
}

.form-label::before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 8px;
    height: 8px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 50%;
    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
}

.form-input, .form-textarea, .form-select {
    width: 100%;
    padding: 0.5rem 0.7rem;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    font-size: 0.85rem;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    position: relative;
}

.form-input:focus, .form-textarea:focus, .form-select:focus {
    outline: none;
    border-color: #667eea;
    background: #ffffff;
    box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1), 0 8px 25px rgba(102, 126, 234, 0.15);
    transform: translateY(-2px);
}

.form-input:hover, .form-textarea:hover, .form-select:hover {
    border-color: #cbd5e0;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.form-textarea {
    min-height: 50px;
    resize: vertical;
    line-height: 1.3;
}

.file-upload-area {
    border: 3px dashed #667eea;
    border-radius: 10px;
    padding: 1.2rem 0.8rem;
    text-align: center;
    background: linear-gradient(135deg, #f7fbff 0%, #f0f4ff 100%);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
}

.file-upload-area::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.file-upload-area:hover {
    border-color: #764ba2;
    background: linear-gradient(135deg, #f0f4ff 0%, #e6f3ff 100%);
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
}

.file-upload-area:hover::before {
    opacity: 1;
}

.file-upload-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    border-radius: 12px;
    padding: 0.8rem 1.5rem;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    margin-bottom: 0.8rem;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    position: relative;
    overflow: hidden;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.file-upload-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s ease;
}

.file-upload-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
}

.file-upload-btn:hover::before {
    left: 100%;
}

.file-upload-btn:active {
    transform: translateY(0);
    box-shadow: 0 2px 10px rgba(102, 126, 234, 0.3);
}

.submit-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    border-radius: 16px;
    padding: 1.2rem 2.5rem;
    font-size: 1.1rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    width: 100%;
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    position: relative;
    overflow: hidden;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.submit-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.6s ease;
}

.submit-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
}

.submit-btn:hover::before {
    left: 100%;
}

.submit-btn:active {
    transform: translateY(-1px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
}

.submit-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
}

/* Success Modal */
.success-modal {
    background: var(--success-gradient);
    color: white;
    border-radius: var(--border-radius);
    padding: 2rem;
    text-align: center;
    box-shadow: var(--hover-shadow);
}

.success-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
}

.success-title {
    font-size: 1.4rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
}

.success-message {
    font-size: 1rem;
    margin-bottom: 1.5rem;
    opacity: 0.9;
}

/* Toastification System */
.toast-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 10000;
    display: flex;
    flex-direction: column;
    gap: 10px;
    max-width: 400px;
}

.toast {
    background: #fff;
    border-radius: 12px;
    padding: 1rem 1.5rem;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
    border-left: 4px solid;
    transform: translateX(100%);
    opacity: 0;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    gap: 1rem;
    min-width: 300px;
}

.toast.show {
    transform: translateX(0);
    opacity: 1;
}

.toast.success {
    border-left-color: #43e97b;
    background: linear-gradient(135deg, #f0fff4 0%, #e6fffa 100%);
}

.toast.error {
    border-left-color: #fa709a;
    background: linear-gradient(135deg, #fff5f5 0%, #fed7d7 100%);
}

.toast.info {
    border-left-color: #4facfe;
    background: linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 100%);
}

.toast.warning {
    border-left-color: #fa709a;
    background: linear-gradient(135deg, #fffaf0 0%, #fef5e7 100%);
}

.toast-icon {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.9rem;
    flex-shrink: 0;
}

.toast.success .toast-icon {
    background: #43e97b;
    color: white;
}

.toast.error .toast-icon {
    background: #fa709a;
    color: white;
}

.toast.info .toast-icon {
    background: #4facfe;
    color: white;
}

.toast.warning .toast-icon {
    background: #fa709a;
    color: white;
}

.toast-content {
    flex: 1;
    min-width: 0;
}

.toast-title {
    font-weight: 600;
    font-size: 0.95rem;
    margin-bottom: 0.2rem;
    color: #2d3748;
}

.toast-message {
    font-size: 0.85rem;
    color: #4a5568;
    line-height: 1.4;
}

.toast-close {
    background: none;
    border: none;
    color: #a0aec0;
    cursor: pointer;
    padding: 0.2rem;
    border-radius: 4px;
    transition: all 0.2s ease;
    font-size: 1.1rem;
    line-height: 1;
    flex-shrink: 0;
}

.toast-close:hover {
    background: rgba(0, 0, 0, 0.1);
    color: #4a5568;
}

.toast-progress {
    position: absolute;
    bottom: 0;
    left: 0;
    height: 3px;
    background: rgba(0, 0, 0, 0.1);
    border-radius: 0 0 12px 12px;
    transition: width linear;
}

.toast.success .toast-progress {
    background: #43e97b;
}

.toast.error .toast-progress {
    background: #fa709a;
}

.toast.info .toast-progress {
    background: #4facfe;
}

.toast.warning .toast-progress {
    background: #fa709a;
}

/* Loading Overlay */
.loading-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(5px);
    z-index: 9999;
    align-items: center;
    justify-content: center;
}

.loading-spinner {
    width: 60px;
    height: 60px;
    border: 4px solid rgba(255, 255, 255, 0.3);
    border-top: 4px solid #667eea;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Responsive Design */
    @media (max-width: 768px) {
        .header-section {
            flex-direction: column;
            align-items: stretch;
        }
        
        .header-left {
            flex-direction: column;
            text-align: center;
        }
        
        .form-row {
            grid-template-columns: 1fr;
        }
        

        
        .file-upload-area {
            height: auto !important;
            min-height: 200px;
        }
        
        .documents-table {
            font-size: 0.8rem;
        }
        
        .documents-table th,
        .documents-table td {
            padding: 0.7rem 0.5rem;
        }
        
        .modal-content {
            width: 95vw;
            margin: 1rem;
            border-radius: 16px;
        }
        
        .modal-header {
            padding: 2rem 1.5rem 1.5rem 1.5rem;
            border-radius: 16px 16px 0 0;
        }
        
        .modal-body {
            padding: 2rem 1.5rem;
        }
        
        .modal-title {
            font-size: 1.4rem;
        }
        
        .form-label {
            font-size: 0.9rem;
            padding-left: 1.2rem;
        }
        
        .form-label::before {
            width: 6px;
            height: 6px;
        }
        
        .form-input, .form-textarea, .form-select {
            padding: 0.9rem 1rem;
            font-size: 0.95rem;
        }
        
        .file-upload-area {
            padding: 2rem 1.5rem;
        }
        
        .submit-btn {
            padding: 1rem 2rem;
            font-size: 1rem;
        }
        
        .pagination-container {
            flex-direction: column;
            gap: 1rem;
        }
    }

@media (max-width: 480px) {
    .header-title {
        font-size: 1.5rem;
    }
    
    .documents-table {
        font-size: 0.75rem;
    }
    
    .documents-table th,
    .documents-table td {
        padding: 0.5rem 0.3rem;
    }
}
</style>

<div class="documents-container">
    <!-- Header Section -->
    <div class="header-section">
        <div class="header-left">
            <div class="header-icon">📤</div>
            <div>
                <h2 class="header-title">Outgoing Documents</h2>
                <p style="margin: 0.5rem 0 0 0; color: #666; font-size: 1rem;">Add, view, and manage outgoing documents</p>
            </div>
        </div>
        
        <button id="openModalBtn" class="add-document-btn">
            <span>➕</span>
            <span>Add Document</span>
        </button>
    </div>

    <!-- Documents Table Section -->
    <div class="table-section">
        <div class="table-header">
            <div>
                <h3 class="table-title">
                    <div class="table-icon">📋</div>
                    All Outgoing Documents
                </h3>
            </div>
        </div>

        <div class="table-container">
            <table class="documents-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Time</th>
                        <th>Control #</th>
                        <th>Source</th>
                        <th>Particulars</th>
                        <th>Forwarded</th>
                        <th>Document</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for doc in outgoing_docs %}
                    <tr>
                        <td>{{ doc.date_sent }}</td>
                        <td>{{ doc.time_sent }}</td>
                        <td>{{ doc.control_no }}</td>
                        <td>{{ doc.source }}</td>
                        <td>{{ doc.particulars }}</td>
                        <td>{{ doc.forwarded_to }}</td>
                        <td>
                            {% if doc.document_file %}
                                <a href="{{ url_for('download_outgoing_file', doc_id=doc.id) }}" class="document-link">{{ doc.document_file }}</a>
                            {% else %}-{% endif %}
                        </td>
                        <td>
                            {% if doc.document_file %}
                                <a href="{{ url_for('preview_outgoing_file', doc_id=doc.id) }}" class="preview-btn" target="_blank">
                                    <span>👁️</span>
                                    <span>Preview</span>
                                </a>
                            {% endif %}
                            <button class="edit-btn edit-document-btn" data-id="{{ doc.id }}" data-date="{{ doc.date_sent }}" data-time="{{ doc.time_sent }}" data-control="{{ doc.control_no }}" data-source="{{ doc.source }}" data-particulars="{{ doc.particulars }}" data-forwarded="{{ doc.forwarded_to }}" data-file="{{ doc.document_file }}">
                                <span>✏️</span>
                                <span>Edit</span>
                            </button>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 3rem; color: #666;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">📭</div>
                            <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem;">No Outgoing Documents Found</div>
                            <div>Start by adding your first outgoing document using the "Add Document" button.</div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- Pagination -->
        {% if total_pages > 1 %}
        <div class="pagination-container">
            <div class="pagination-info">
                Page {{ page }} of {{ total_pages }}
            </div>
            
            <div class="pagination-controls">
                {% if has_prev %}
                    <a href="{{ url_for('releasing_outgoing_docs', page=page-1) }}" class="pagination-button">
                        <span>←</span>
                        <span>Previous</span>
                    </a>
                {% else %}
                    <button class="pagination-button" disabled>
                        <span>←</span>
                        <span>Previous</span>
                    </button>
                {% endif %}
                
                {% for p in range(1, total_pages + 1) %}
                    {% if p == page %}
                        <span class="pagination-button active">{{ p }}</span>
                    {% elif p <= 3 or p >= total_pages - 2 or (p >= page - 1 and p <= page + 1) %}
                        <a href="{{ url_for('releasing_outgoing_docs', page=p) }}" class="pagination-button">
                            {{ p }}
                        </a>
                    {% elif p == 4 and page > 5 %}
                        <span style="color: #6c757d; padding: 0.6rem 0.3rem;">...</span>
                    {% elif p == total_pages - 3 and page < total_pages - 4 %}
                        <span style="color: #6c757d; padding: 0.6rem 0.3rem;">...</span>
                    {% endif %}
                {% endfor %}
                
                {% if has_next %}
                    <a href="{{ url_for('releasing_outgoing_docs', page=page+1) }}" class="pagination-button">
                        <span>Next</span>
                        <span>→</span>
                    </a>
                {% else %}
                    <button class="pagination-button" disabled>
                        <span>Next</span>
                        <span>→</span>
                    </button>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Add Document Modal -->
<div id="addDocModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Add New Document</h3>
            <button class="modal-close" id="closeModalBtn">&times;</button>
        </div>
        <div class="modal-body">
            <form method="POST" enctype="multipart/form-data" autocomplete="off" style="position: relative;">
                <!-- Form Header -->
                <div style="text-align: center; margin-bottom: 0.8rem; padding-bottom: 0.6rem; border-bottom: 2px solid #f1f5f9;">
                    <div style="font-size: 0.95rem; font-weight: 700; color: #2d3748; margin-bottom: 0.15rem;">📋 Document Information</div>
                    <div style="font-size: 0.75rem; color: #64748b;">Please fill in all required fields to add a new outgoing document</div>
                </div>
                
                <!-- Single Column Layout -->
                <div style="display: flex; flex-direction: column; gap: 0.6rem;">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Date Received</label>
                            <input type="date" name="date_sent" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Time</label>
                            <input type="time" name="time_sent" class="form-input" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Control #</label>
                            <input type="text" name="control_no" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Source</label>
                            <input type="text" name="source" class="form-input" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Particulars</label>
                        <textarea name="particulars" class="form-textarea" required style="min-height: 50px;"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Forwarded To</label>
                        <input type="text" name="forwarded_to" class="form-input" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Attach Document</label>
                        <div class="file-upload-area" style="height: 100px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
                            <input type="file" name="document_file" class="form-input" accept=".pdf,.jpg,.jpeg,.png,.doc,.docx" style="display:none;" id="fileInput">
                            <button type="button" class="file-upload-btn" onclick="document.getElementById('fileInput').click();">
                                <span style="font-size: 1.1rem;">📁</span>
                                <span>Choose File</span>
                            </button>
                            <div style="margin-top: 0.5rem; text-align: center;">
                                <span id="fileName" style="color:#667eea;font-size:0.8rem;font-weight:600;"></span>
                            </div>
                            <div style="font-size: 0.7rem; color: #64748b; margin-top: 0.15rem; text-align: center;">
                                Supported formats: PDF, JPG, PNG, DOC, DOCX
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Submit Section -->
                <div style="margin-top: 1.2rem; padding-top: 0.8rem; border-top: 2px solid #f1f5f9;">
                    <button type="submit" class="submit-btn">
                        <span style="margin-right: 0.5rem;">✅</span>
                        Add Document
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Loading overlay to prevent duplicate submissions when adding an outgoing document -->
<div id="outgoingLoadingOverlay" class="loading-overlay">
    <div style="background:#fff;border-radius:16px;padding:1.6rem 2rem;box-shadow:0 8px 40px #0003;display:flex;flex-direction:column;align-items:center;gap:0.9rem;min-width:260px;">
        <div class="loading-spinner"></div>
        <div style="font-weight:700;color:#667eea;font-size:1.05rem;">Storing, please wait…</div>
    </div>
</div>

<!-- Toastification Container -->
<div class="toast-container" id="toastContainer"></div>

<!-- Edit Document Modal -->
<div id="editDocModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Edit Outgoing Document</h3>
            <button class="modal-close" onclick="closeEditDocModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="editDocForm" enctype="multipart/form-data" autocomplete="off">
                <input type="hidden" id="editDocId" name="doc_id">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Date Sent</label>
                        <input type="date" name="date_sent" id="editDateSent" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Time</label>
                        <input type="time" name="time_sent" id="editTimeSent" class="form-input" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Control #</label>
                        <input type="text" name="control_no" id="editControlNo" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Source</label>
                        <input type="text" name="source" id="editSource" class="form-input" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Particulars</label>
                    <textarea name="particulars" id="editParticulars" class="form-textarea" required></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Forwarded To</label>
                    <input type="text" name="forwarded_to" id="editForwardedTo" class="form-input" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Update Document (Optional)</label>
                    <div class="file-upload-area">
                        <input type="file" name="document_file" id="editDocumentFile" class="form-input" style="display:none;">
                        <button type="button" class="file-upload-btn" onclick="document.getElementById('editDocumentFile').click()">
                            Choose New File
                        </button>
                        <div id="editSelectedFileName" style="color:#666;font-size:0.9rem;"></div>
                        <div id="currentFileName" style="color:#667eea;font-size:0.9rem;font-weight:600;margin-top:0.5rem;"></div>
                    </div>
                </div>
                
                <button type="submit" class="submit-btn">Update Document</button>
            </form>
        </div>
    </div>
</div>

<!-- Edit Success Modal -->
<div id="editSuccessModal" class="modal-overlay">
    <div class="modal-content" style="max-width: 400px;">
        <div class="success-modal">
            <div class="success-icon">✅</div>
            <div class="success-title">Document Updated!</div>
            <div class="success-message">Your document was successfully updated in the system.</div>
            <button onclick="closeEditSuccessModal()" class="submit-btn" style="background: white; color: #43e97b; margin-top: 1rem;">
                OK
            </button>
        </div>
    </div>
</div>

<!-- Success Toast Trigger -->
{% if success %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        showToast('success', 'Document Added Successfully!', 'Your document was successfully added to the system.');
    });
</script>
{% endif %}

<!-- Success Popup Modal -->
{% if success %}
<div id="successModal" class="modal-overlay" style="display: flex;">
    <div class="modal-content" style="max-width: 400px;">
        <div class="success-modal">
            <div class="success-icon">✅</div>
            <div class="success-title">Success!</div>
            <div class="success-message">Document has been added successfully.</div>
            <button onclick="closeSuccessModal()" class="submit-btn" style="background: white; color: #43e97b; margin-top: 1rem;">
                OK
            </button>
        </div>
    </div>
</div>
<script>
function closeSuccessModal() {
    document.getElementById('successModal').style.display = 'none';
}
// Auto-close after 3 seconds
setTimeout(function() {
    if (document.getElementById('successModal')) {
        document.getElementById('successModal').style.display = 'none';
    }
}, 3000);
</script>
{% endif %}

<script>
// Toastification System
function showToast(type, title, message, duration = 5000) {
    const container = document.getElementById('toastContainer');
    const toast = document.createElement('div');
    const toastId = 'toast-' + Date.now();
    
    const icons = {
        success: '✅',
        error: '❌',
        warning: '⚠️',
        info: 'ℹ️'
    };
    
    toast.className = `toast ${type}`;
    toast.id = toastId;
    toast.innerHTML = `
        <div class="toast-icon">${icons[type]}</div>
        <div class="toast-content">
            <div class="toast-title">${title}</div>
            <div class="toast-message">${message}</div>
        </div>
        <button class="toast-close" onclick="removeToast('${toastId}')">&times;</button>
        <div class="toast-progress"></div>
    `;
    
    container.appendChild(toast);
    
    // Trigger animation
    setTimeout(() => {
        toast.classList.add('show');
    }, 10);
    
    // Auto-remove after duration
    if (duration > 0) {
        setTimeout(() => {
            removeToast(toastId);
        }, duration);
        
        // Progress bar animation
        const progress = toast.querySelector('.toast-progress');
        progress.style.width = '100%';
        progress.style.transition = `width ${duration}ms linear`;
        setTimeout(() => {
            progress.style.width = '0%';
        }, 10);
    }
}

function removeToast(toastId) {
    const toast = document.getElementById(toastId);
    if (toast) {
        toast.classList.remove('show');
        setTimeout(() => {
            if (toast.parentNode) {
                toast.parentNode.removeChild(toast);
            }
        }, 400);
    }
}

// Clear success parameter from URL
function clearSuccessParameter() {
    if (window.history.replaceState) {
        const url = new URL(window.location);
        url.searchParams.delete('success');
        window.history.replaceState({}, document.title, url.pathname + url.search);
    }
}

    var modal = document.getElementById('addDocModal');
    var openBtn = document.getElementById('openModalBtn');
    var closeBtn = document.getElementById('closeModalBtn');

    // Submission guard and overlay control
    let isOutgoingSubmitting = false;
    function resetOutgoingSubmitState() {
        isOutgoingSubmitting = false;
        const submitBtn = document.querySelector('#addDocModal form button[type="submit"]');
        if (submitBtn) {
            submitBtn.disabled = false;
            submitBtn.textContent = 'Add Document';
        }
        const overlay = document.getElementById('outgoingLoadingOverlay');
        if (overlay) overlay.style.display = 'none';
    }
    
    // Hook form submission to show loading state and prevent double submit
    (function() {
        const addForm = document.querySelector('#addDocModal form');
        if (!addForm) return;
        addForm.addEventListener('submit', function(e) {
            if (isOutgoingSubmitting) { e.preventDefault(); return; }
            isOutgoingSubmitting = true;
            const submitBtn = addForm.querySelector('button[type="submit"]');
            if (submitBtn) { submitBtn.disabled = true; submitBtn.textContent = 'Saving…'; }
            const overlay = document.getElementById('outgoingLoadingOverlay');
            if (overlay) overlay.style.display = 'flex';
            // allow normal form submission
        });
    })();

    openBtn.onclick = function() {
        // Set current date and time when modal opens
        var now = new Date();
        var dateInput = document.querySelector('input[name="date_sent"]');
        var timeInput = document.querySelector('input[name="time_sent"]');
        if (dateInput) {
            var yyyy = now.getFullYear();
            var mm = String(now.getMonth() + 1).padStart(2, '0');
            var dd = String(now.getDate()).padStart(2, '0');
            dateInput.value = yyyy + '-' + mm + '-' + dd;
        }
        if (timeInput) {
            var hh = String(now.getHours()).padStart(2, '0');
            var min = String(now.getMinutes()).padStart(2, '0');
            timeInput.value = hh + ':' + min;
        }
        resetOutgoingSubmitState();
        modal.style.display = 'flex';
        setTimeout(() => {
            modal.classList.add('show');
        }, 10);
    }
    
    closeBtn.onclick = function() { 
        modal.classList.remove('show');
        setTimeout(() => {
            modal.style.display = 'none';
        }, 300);
    }
    
    window.onclick = function(event) {
        if (event.target == modal) { 
            modal.classList.remove('show');
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }
    }
    
    // File input display
    var fileInput = document.getElementById('fileInput');
    var fileName = document.getElementById('fileName');
    fileInput.onchange = function() {
        if (fileInput.files.length > 0) {
            fileName.textContent = fileInput.files[0].name;
        } else {
            fileName.textContent = '';
        }
    }

    // Edit document functionality
    document.addEventListener('DOMContentLoaded', function() {
        // Edit document functionality
        document.querySelectorAll('.edit-document-btn').forEach(function(btn) {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                var docId = btn.getAttribute('data-id');
                openEditModal(docId, btn);
            });
        });

        // Edit modal form submission
        document.getElementById('editDocForm').addEventListener('submit', function(e) {
            e.preventDefault();
            submitEditForm();
        });

        // File input change handler for edit modal
        document.getElementById('editDocumentFile').addEventListener('change', function(e) {
            var fileName = e.target.files.length ? e.target.files[0].name : '';
            document.getElementById('editSelectedFileName').textContent = fileName;
        });
    });

    // Edit modal functions
    function openEditModal(docId, btn) {
        // Fetch document data from server
        fetch(`/releasing/outgoing/edit/${docId}`)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const doc = data.document;
                    // Populate form with fetched data
                    document.getElementById('editDocId').value = doc.id;
                    document.getElementById('editDateSent').value = doc.date_sent;
                    document.getElementById('editTimeSent').value = doc.time_sent;
                    document.getElementById('editControlNo').value = doc.control_no;
                    document.getElementById('editSource').value = doc.source;
                    document.getElementById('editParticulars').value = doc.particulars;
                    document.getElementById('editForwardedTo').value = doc.forwarded_to;
                    document.getElementById('currentFileName').textContent = doc.document_file || 'No file attached';
                    document.getElementById('editSelectedFileName').textContent = '';
                    document.getElementById('editDocModal').style.display = 'flex';
                    setTimeout(() => {
                        document.getElementById('editDocModal').classList.add('show');
                    }, 10);
                } else {
                    showToast('error', 'Load Failed', data.message || 'Error loading document data');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showToast('error', 'Load Failed', 'An error occurred while loading document data');
            });
    }

    function closeEditDocModal() {
        document.getElementById('editDocModal').classList.remove('show');
        setTimeout(() => {
            document.getElementById('editDocModal').style.display = 'none';
        }, 300);
    }

    function submitEditForm() {
        const form = document.getElementById('editDocForm');
        const formData = new FormData(form);
        const docId = document.getElementById('editDocId').value;

        fetch(`/releasing/outgoing/edit/${docId}`, {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                closeEditDocModal();
                showToast('success', 'Document Updated!', 'Your document was successfully updated.');
                setTimeout(() => {
                    window.location.reload();
                }, 1500);
            } else {
                showToast('error', 'Update Failed', data.message || 'Error updating document');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showToast('error', 'Update Failed', 'An error occurred while updating the document');
        });
    }

    function showEditSuccessModal() {
        document.getElementById('editSuccessModal').style.display = 'flex';
        setTimeout(() => {
            document.getElementById('editSuccessModal').classList.add('show');
        }, 10);
        setTimeout(closeEditSuccessModal, 2000);
    }

    function closeEditSuccessModal() {
        document.getElementById('editSuccessModal').classList.remove('show');
        setTimeout(() => {
            document.getElementById('editSuccessModal').style.display = 'none';
        }, 300);
        // Reload the page to show updated data
        window.location.reload();
    }

    // Close edit modal when clicking outside
    window.addEventListener('click', function(event) {
        const editModal = document.getElementById('editDocModal');
        if (event.target === editModal) {
            closeEditDocModal();
        }
    });

    // Clear success parameter after showing toast
    if (window.location.search.includes('success=1')) {
        setTimeout(clearSuccessParameter, 1000);
    }
</script>

{% endblock %} 